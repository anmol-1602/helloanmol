---
import { getCollection } from 'astro:content';

// Fetch all entries from the 'booknotes' collection
const books = await getCollection('booknotes');

// Optional: Sort them so the newest "Finished" dates appear first
const sortedBooks = books.sort((a, b) => b.data.finished.localeCompare(a.data.finished));
---

<section class="grid grid-cols-1 gap-x-8 gap-y-16 sm:grid-cols-2 lg:grid-cols-3">
  {sortedBooks.map((book) => (
    <div class="group flex h-full w-full flex-col rounded-[2.5rem] bg-white px-8 pt-8 pb-8 shadow-[0_10px_40px_-15px_rgba(0,0,0,0.04)] transition-all duration-700 hover:shadow-[0_40px_80px_-20px_rgba(0,0,0,0.12)]">
      
      {/* Image pulls from Markdown Frontmatter */}
      <div class="mb-8 flex h-52 items-center justify-center overflow-hidden">
        <img 
          src={book.data.image} 
          class="h-full object-contain drop-shadow-[0_20px_30px_rgba(0,0,0,0.12)] transition-transform duration-700 group-hover:scale-105" 
          alt={book.data.title} 
        />
      </div>

      <div class="flex flex-grow flex-col px-2 text-center">
        {/* Title and Author pull from Markdown */}
        <h2 class="mb-4 line-clamp-2 font-serif text-[22px] leading-tight font-black text-slate-900">
          {book.data.title} by {book.data.author}
        </h2>

        <div class="mt-auto">
          <div class="mb-6 flex items-center justify-between border-t border-slate-100 pt-6">
            <div class="text-left">
              <span class="block text-[8px] font-black tracking-widest text-slate-300 uppercase">Rating</span>
              <span class="font-serif text-base leading-none text-slate-900 italic">{book.data.rating}</span>
            </div>
            <div class="text-right">
              <span class="block text-[8px] font-black tracking-widest text-slate-300 uppercase">Finished</span>
              <span class="font-serif text-base leading-none text-slate-900 italic">{book.data.finished}</span>
            </div>
          </div>

          {/* This dynamic link leads to the individual note page */}
          <a href={`/library/${book.slug}`} class="inline-flex items-center justify-center gap-2 text-[12px] font-black tracking-widest text-slate-900 uppercase transition-colors group-hover:text-rose-500"> 
            Read Notes <span class="text-lg transition-transform group-hover:translate-x-1">â†’</span> 
          </a>
        </div>
      </div>
    </div>
  ))}
</section>
